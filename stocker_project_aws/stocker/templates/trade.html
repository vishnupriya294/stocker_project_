<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trade {{ stock.symbol }} - Stocker</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <header class="header">
        <div class="container">
            <nav class="nav">
                <a href="/dashboard" class="logo">Stocker</a>
                <div class="nav-links">
                    <a href="/dashboard" class="nav-link">Dashboard</a>
                    <a href="/portfolio" class="nav-link">Portfolio</a>
                    <a href="/history" class="nav-link">History</a>
                    <a href="/logout" class="nav-link">Logout ({{ session.username }})</a>
                </div>
            </nav>
        </div>
    </header>

    <main class="main-content">
        <div class="container">
            <div class="trade-form">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Trade {{ stock.symbol }}</h2>
                        <a href="/dashboard" class="btn btn-secondary btn-sm">‚Üê Back to Dashboard</a>
                    </div>

                    <div class="stock-info mb-4">
                        <div class="stock-card" data-symbol="{{ stock.symbol }}">
                            <div class="stock-symbol">{{ stock.symbol }}</div>
                            <div class="stock-name">{{ stock.name }}</div>
                            <div class="stock-price">${{ "%.2f"|format(stock.price) }}</div>
                            <div class="stock-change {% if stock.change >= 0 %}positive{% else %}negative{% endif %}">
                                {{ "+" if stock.change >= 0 else "" }}${{ "%.2f"|format(stock.change) }}
                            </div>
                        </div>
                    </div>

                    {% with messages = get_flashed_messages() %}
                        {% if messages %}
                            {% for message in messages %}
                                <div class="alert alert-danger">{{ message }}</div>
                            {% endfor %}
                        {% endif %}
                    {% endwith %}

                    <form method="POST" action="/execute_trade" class="fade-in">
                        <input type="hidden" name="symbol" value="{{ stock.symbol }}">

                        <div class="form-group">
                            <label for="action" class="form-label">Action</label>
                            <select name="action" id="action" class="form-input form-select" required>
                                <option value="buy">Buy</option>
                                <option value="sell">Sell</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="quantity" class="form-label">Quantity</label>
                            <div class="quantity-input">
                                <button type="button" class="quantity-btn" data-action="decrease">-</button>
                                <input 
                                    type="number" 
                                    id="quantity" 
                                    name="quantity" 
                                    class="form-input" 
                                    value="1" 
                                    min="1" 
                                    max="10000"
                                    style="text-align: center;"
                                    required
                                >
                                <button type="button" class="quantity-btn" data-action="increase">+</button>
                            </div>
                        </div>

                        <div class="trade-summary">
                            <div class="d-flex justify-between mb-2">
                                <span>Price per share:</span>
                                <span class="stock-price">${{ "%.2f"|format(stock.price) }}</span>
                            </div>
                            <div class="d-flex justify-between mb-2">
                                <span>Quantity:</span>
                                <span id="summary-quantity">1</span>
                            </div>
                            <div class="d-flex justify-between" style="font-weight: 600; font-size: 1.125rem;">
                                <span>Total Cost:</span>
                                <span id="total-cost">${{ "%.2f"|format(stock.price) }}</span>
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary w-full btn-lg">Execute Trade</button>
                    </form>

                    <div class="card mt-4" style="background: var(--secondary-bg);">
                        <h4 style="margin-bottom: 1rem;">Trading Information</h4>
                        <div style="font-size: 0.875rem; color: var(--text-secondary);">
                            <p><strong>Market Hours:</strong> 24/7 (Virtual Trading)</p>
                            <p><strong>Settlement:</strong> Instant execution</p>
                            <p><strong>Fees:</strong> No trading fees</p>
                            <p><strong>Minimum Order:</strong> 1 share</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
    <script>
        // Update summary when quantity changes
        document.getElementById('quantity').addEventListener('input', function() {
            const quantity = parseInt(this.value) || 1;
            const price = {{ stock.price }};
            const total = quantity * price;
            
            document.getElementById('summary-quantity').textContent = quantity;
            document.getElementById('total-cost').textContent = `$${total.toFixed(2)}`;
        });
    </script>
</body>
</html>